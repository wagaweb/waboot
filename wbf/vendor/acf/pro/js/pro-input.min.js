!function (t) {
    acf.pro = acf.model.extend({
        actions: {
            conditional_logic_show_field: "show_field_cl",
            conditional_logic_hide_field: "hide_field_cl"
        }, filters: {is_field_ready_for_js: "is_field_ready_for_js"}, is_field_ready_for_js: function (t, e) {
            return e.data("acf_clone") ? !1 : e.closest(".clone").exists() ? (e.data("acf_clone", 1), !1) : e.closest(".clones").exists() ? (e.data("acf_clone", 1), !1) : t
        }, show_field_cl: function (t) {
            if (acf.is_sub_field(t) && t.is("td")) {
                var e = acf.get_field_key(t), a = t.closest(".acf-table"), i = a.find('> thead > tr > th[data-key="' + e + '"]'), l = a.find('> tbody > tr:not(.clone) > td[data-key="' + e + '"]');
                t.removeClass("appear-empty"), l.filter(".hidden-by-conditional-logic").addClass("appear-empty"), i.removeClass("hidden-by-conditional-logic"), this.render_table(a)
            }
        }, hide_field_cl: function (t) {
            if (acf.is_sub_field(t) && t.is("td")) {
                var e = acf.get_field_key(t), a = t.closest(".acf-table"), i = a.find('> thead > tr > th[data-key="' + e + '"]'), l = a.find('> tbody > tr:not(.clone) > td[data-key="' + e + '"]');
                t.addClass("appear-empty"), l.filter(".hidden-by-conditional-logic").length == l.length && (l.removeClass("appear-empty"), i.addClass("hidden-by-conditional-logic")), this.render_table(a)
            }
        }, render_table: function (e) {
            if (!e.hasClass("row-layout")) {
                var a = e.find("> thead > tr > th"), i = 100, l = 0;
                a.filter(".order").exists() && (i = 93), a.removeAttr("width"), a = a.not(".order, .remove, .hidden-by-conditional-logic"), a.filter("[data-width]").each(function () {
                    if (l + 1 == a.length)return !1;
                    l++;
                    var e = parseInt(t(this).attr("data-width"));
                    i -= e, t(this).attr("width", e + "%")
                }), a.not("[data-width]").each(function () {
                    if (l + 1 == a.length)return !1;
                    l++;
                    var e = i / a.length;
                    t(this).attr("width", e + "%")
                })
            }
        }
    }), acf.fields.repeater = acf.field.extend({
        type: "repeater",
        $el: null,
        $clone: null,
        actions: {ready: "initialize", append: "initialize"},
        events: {
            "click .acf-repeater-add-row": "add",
            "click .acf-repeater-remove-row": "remove",
            "mouseenter .acf-row": "mouseenter"
        },
        focus: function () {
            this.$el = this.$field.find(".acf-repeater").first(), this.$clone = this.$el.find("> table > tbody > tr.clone"), this.settings = acf.get_data(this.$el)
        },
        initialize: function () {
            var t = this, e = this.$field;
            1 != this.settings.max && this.$el.find("> table > tbody").unbind("sortable").sortable({
                items: "> tr",
                handle: "> td.order",
                forceHelperSize: !0,
                forcePlaceholderSize: !0,
                scroll: !0,
                start: function (t, e) {
                    acf.do_action("sortstart", e.item, e.placeholder)
                },
                stop: function (a, i) {
                    acf.do_action("sortstop", i.item, i.placeholder), t.doFocus(e).render()
                }
            }), acf.pro.render_table(this.$el.find("> table")), this.$clone.find("[name]").attr("disabled", "disabled"), this.render()
        },
        count: function () {
            return this.$el.find("> table > tbody > tr").length - 1
        },
        render: function () {
            this.$el.find("> table > tbody > tr").each(function (e) {
                t(this).children("td.order").html(e + 1)
            }), 0 == this.count() ? this.$el.addClass("empty") : this.$el.removeClass("empty"), this.settings.max > 0 && this.count() >= this.settings.max ? (this.$el.addClass("disabled"), this.$el.find("> .acf-hl .acf-button").addClass("disabled")) : (this.$el.removeClass("disabled"), this.$el.find("> .acf-hl .acf-button").removeClass("disabled"))
        },
        add: function (e) {
            var a = this.$clone;
            if (e && e.$el.is(".acf-icon") && (a = e.$el.closest(".acf-row")), this.settings.max > 0 && this.count() >= this.settings.max)return alert(acf._e("repeater", "max").replace("{max}", this.settings.max)), !1;
            var i = acf.get_uniqid(), l = this.$clone.outerHTML(), l = l.replace(/(="[\w-\[\]]+?)(acfcloneindex)/g, "$1" + i), s = t(l);
            return s.removeClass("clone"), s.find("[name]").removeAttr("disabled"), a.before(s), this.$field.parents(".acf-row").trigger("mouseenter"), this.render(), acf.validation.remove_error(this.$field), acf.do_action("append", s), s
        },
        remove: function (t) {
            var e = this, a = this.$field, i = t.$el.closest(".acf-row"), l = i.closest("table");
            return this.count() <= this.settings.min ? (alert(acf._e("repeater", "min").replace("{min}", this.settings.min)), !1) : void acf.remove_tr(i, function () {
                e.doFocus(a).render(), a.closest(".acf-row").trigger("mouseenter"), l.hasClass("table-layout") && acf.conditional_logic.render(l)
            })
        },
        mouseenter: function (t) {
            var e = t.$el.find("> td.remove"), a = e.find(".acf-repeater-add-row"), i = e.height() / 2 + 9;
            a.css("margin-top", "-" + i + "px")
        }
    }), acf.fields.flexible_content = acf.field.extend({
        type: "flexible_content",
        $el: null,
        $values: null,
        $clones: null,
        actions: {ready: "initialize", append: "initialize"},
        events: {
            "click .acf-fc-remove": "remove",
            "click .acf-fc-layout-handle": "toggle",
            "click .acf-fc-popup li a": "add",
            "click .acf-fc-add": "open_popup",
            "blur .acf-fc-popup .focus": "close_popup"
        },
        focus: function () {
            this.$el = this.$field.find(".acf-flexible-content").first(), this.$values = this.$el.children(".values"), this.$clones = this.$el.children(".clones"), this.settings = acf.get_data(this.$el), this.settings.min = this.settings.min || 0, this.settings.max = this.settings.max || 0
        },
        count: function () {
            return this.$values.children(".layout").length
        },
        initialize: function () {
            var e = this, a = this.$field;
            1 != this.settings.max && this.$values.unbind("sortable").sortable({
                items: "> .layout",
                handle: "> .acf-fc-layout-handle",
                forceHelperSize: !0,
                forcePlaceholderSize: !0,
                scroll: !0,
                start: function (t, e) {
                    acf.do_action("sortstart", e.item, e.placeholder)
                },
                stop: function (t, i) {
                    acf.do_action("sortstop", i.item, i.placeholder), e.doFocus(a).render()
                }
            }), this.$values.find("> .layout > .acf-table").each(function () {
                acf.pro.render_table(t(this))
            }), this.$clones.find("[name]").attr("disabled", "disabled"), this.render()
        },
        render: function () {
            this.$values.children(".layout").each(function (e) {
                t(this).find("> .acf-fc-layout-handle .fc-layout-order").html(e + 1)
            }), 0 == this.count() ? this.$el.addClass("empty") : this.$el.removeClass("empty"), this.settings.max > 0 && this.count() >= this.settings.max ? (this.$el.addClass("disabled"), this.$el.find("> .acf-hl .acf-button").addClass("disabled")) : (this.$el.removeClass("disabled"), this.$el.find("> .acf-hl .acf-button").removeClass("disabled"))
        },
        validate_add: function (e) {
            if (this.settings.max > 0 && this.count() >= this.settings.max) {
                var a = 1 == this.settings.max ? "layout" : "layouts", i = acf._e("flexible_content", "max");
                return i = i.replace("{max}", this.settings.max), i = i.replace("{identifier}", acf._e("flexible_content", a)), alert(i), !1
            }
            var l = t(this.$el.children(".tmpl-popup").html()), s = l.find('[data-layout="' + e + '"]'), n = parseInt(s.attr("data-max")), c = this.$values.children('.layout[data-layout="' + e + '"]').length;
            if (n > 0 && c >= n) {
                var a = 1 == n ? "layout" : "layouts", i = acf._e("flexible_content", "max_layout");
                return i = i.replace("{max}", c), i = i.replace("{label}", '"' + s.text() + '"'), i = i.replace("{identifier}", acf._e("flexible_content", a)), alert(i), !1
            }
            return !0
        },
        validate_remove: function (e) {
            if (this.settings.min > 0 && this.count() <= this.settings.min) {
                var a = 1 == this.settings.min ? "layout" : "layouts", i = acf._e("flexible_content", "min") + ", " + acf._e("flexible_content", "remove");
                return i = i.replace("{min}", this.settings.min), i = i.replace("{identifier}", acf._e("flexible_content", a)), i = i.replace("{layout}", acf._e("flexible_content", "layout")), confirm(i)
            }
            var l = t(this.$el.children(".tmpl-popup").html()), s = l.find('[data-layout="' + e + '"]'), n = parseInt(s.attr("data-min")), c = this.$values.children('.layout[data-layout="' + e + '"]').length;
            if (n > 0 && n >= c) {
                var a = 1 == n ? "layout" : "layouts", i = acf._e("flexible_content", "min_layout") + ", " + acf._e("flexible_content", "remove");
                return i = i.replace("{min}", c), i = i.replace("{label}", '"' + s.text() + '"'), i = i.replace("{identifier}", acf._e("flexible_content", a)), i = i.replace("{layout}", acf._e("flexible_content", "layout")), confirm(i)
            }
            return !0
        },
        open_popup: function (e) {
            var a = this.$values, i = t(this.$el.children(".tmpl-popup").html());
            i.find("a").each(function () {
                var e = parseInt(t(this).attr("data-min")), i = parseInt(t(this).attr("data-max")), l = t(this).attr("data-layout"), s = t(this).text(), n = a.children('.layout[data-layout="' + l + '"]').length, c = t(this).children(".status");
                if (i > 0) {
                    var r = i - n, o = acf._e("flexible_content", "available"), d = 1 == r ? "layout" : "layouts", o = o.replace("{available}", r);
                    o = o.replace("{max}", i), o = o.replace("{label}", '"' + s + '"'), o = o.replace("{identifier}", acf._e("flexible_content", d)), c.show().text(r).attr("title", o), 0 == r && c.addClass("warning")
                }
                if (e > 0) {
                    var f = e - n, o = acf._e("flexible_content", "required"), d = 1 == f ? "layout" : "layouts", o = o.replace("{required}", f);
                    o = o.replace("{min}", e), o = o.replace("{label}", '"' + s + '"'), o = o.replace("{identifier}", acf._e("flexible_content", d)), f > 0 && c.addClass("warning").show().text(f).attr("title", o)
                }
            }), e.$el.after(i), e.$el.attr("data-before") && (i.addClass("within-layout"), i.closest(".layout").addClass("popup-open")), i.css({
                "margin-top": 0 - i.height() - e.$el.outerHeight() - 14,
                "margin-left": (e.$el.outerWidth() - i.width()) / 2
            });
            var l = i.offset().top;
            30 > l && (i.css({"margin-top": 15}), i.find(".bit").addClass("top")), i.children(".focus").trigger("focus")
        },
        close_popup: function (t) {
            var e = t.$el.parent();
            e.closest(".layout").exists() && e.closest(".layout").removeClass("popup-open"), setTimeout(function () {
                e.remove()
            }, 200)
        },
        add: function (e) {
            var a = e.$el.closest(".acf-fc-popup"), i = e.$el.attr("data-layout");
            if (this.validate_add(i)) {
                var l = acf.get_uniqid(), s = this.$clones.children('.layout[data-layout="' + i + '"]').outerHTML(), s = s.replace(/(="[\w-\[\]]+?)(acfcloneindex)/g, "$1" + l), n = t(s);
                n.find("[name]").removeAttr("disabled"), this.$el.children(".no-value-message").hide(), this.$values.append(n), a.hasClass("within-layout") && a.closest(".layout").before(n), acf.do_action("append", n), this.render(), acf.validation.remove_error(this.$field)
            }
        },
        remove: function (t) {
            var e = t.$el.closest(".layout");
            if (this.validate_remove(e.attr("data-layout"))) {
                var a = 0, i = this.$el.children(".no-value-message");
                0 == e.siblings(".layout").length && (a = i.outerHeight()), acf.remove_el(e, function () {
                    a > 0 && i.show()
                }, a)
            }
        },
        toggle: function (t) {
            var e = t.$el.closest(".layout");
            "closed" == e.attr("data-toggle") ? (e.attr("data-toggle", "open"), e.children(".acf-input-table").show()) : (e.attr("data-toggle", "closed"), e.children(".acf-input-table").hide()), this.sync()
        },
        sync: function () {
            var e = "acf_collapsed_" + acf.get_data(this.$field, "key"), a = [];
            this.$values.children(".layout").each(function (e) {
                "closed" == t(this).attr("data-toggle") && a.push(e)
            }), acf.update_cookie(e, a.join("|"))
        }
    }), acf.fields.gallery = acf.field.extend({
        type: "gallery",
        $el: null,
        actions: {ready: "initialize", append: "initialize", submit: "close_sidebar"},
        events: {
            "click .acf-gallery-attachment": "select_attachment",
            "click .remove-attachment": "remove_attachment",
            "click .edit-attachment": "edit_attachment",
            "click .update-attachment": "update_attachment",
            "click .add-attachment": "add_attachment",
            "click .close-sidebar": "close_sidebar",
            "change .acf-gallery-side input": "update_attachment",
            "change .acf-gallery-side textarea": "update_attachment",
            "change .acf-gallery-side select": "update_attachment",
            "change .bulk-actions": "sort"
        },
        focus: function () {
            this.$el = this.$field.find(".acf-gallery").first(), this.$values = this.$el.children(".values"), this.$clones = this.$el.children(".clones"), this.settings = acf.get_data(this.$el), this.settings.min = this.settings.min || 0, this.settings.max = this.settings.max || 0
        },
        get_attachment: function (t) {
            t = t || "";
            var e = ".acf-gallery-attachment";
            return "active" === t ? e += ".active" : t && (e += '[data-id="' + t + '"]'), this.$el.find(e)
        },
        count: function () {
            return this.get_attachment().length
        },
        initialize: function () {
            var e = this, a = this.$field;
            this.$el.find(".acf-gallery-attachments").unbind("sortable").sortable({
                items: ".acf-gallery-attachment",
                forceHelperSize: !0,
                forcePlaceholderSize: !0,
                scroll: !0,
                start: function (t, e) {
                    e.placeholder.html(e.item.html()), e.placeholder.removeAttr("style"), acf.do_action("sortstart", e.item, e.placeholder)
                },
                stop: function (t, e) {
                    acf.do_action("sortstop", e.item, e.placeholder)
                }
            }), this.$el.unbind("resizable").resizable({
                handles: "s", minHeight: 200, stop: function (t, e) {
                    acf.update_user_setting("gallery_height", e.size.height)
                }
            }), t(window).on("resize", function () {
                e.doFocus(a).resize()
            }), this.render(), this.resize()
        },
        render: function () {
            var t = this.$el.find(".bulk-actions"), e = this.$el.find(".add-attachment");
            this.settings.max > 0 && this.count() >= this.settings.max ? e.addClass("disabled") : e.removeClass("disabled")
        },
        sort: function (e) {
            var a = e.$el.val();
            if (a) {
                var i = acf.prepare_for_ajax({
                    action: "acf/fields/gallery/get_sort_order",
                    field_key: this.settings.key,
                    post_id: acf.get("post_id"),
                    ids: [],
                    sort: a
                });
                this.get_attachment().each(function () {
                    i.ids.push(t(this).attr("data-id"))
                });
                var l = t.ajax({
                    url: acf.get("ajaxurl"),
                    dataType: "json",
                    type: "post",
                    cache: !1,
                    data: i,
                    context: this,
                    success: this.sort_success
                })
            }
        },
        sort_success: function (t) {
            if (acf.is_ajax_success(t)) {
                t.data.reverse();
                for (i in t.data) {
                    var e = t.data[i], a = this.get_attachment(e);
                    this.$el.find(".acf-gallery-attachments").prepend(a)
                }
            }
        },
        clear_selection: function () {
            this.get_attachment().removeClass("active")
        },
        select_attachment: function (t) {
            var e = t.$el;
            if (!e.hasClass("active")) {
                var a = e.attr("data-id");
                this.clear_selection(), e.addClass("active"), this.fetch(a), this.open_sidebar()
            }
        },
        open_sidebar: function () {
            this.$el.addClass("sidebar-open"), this.$el.find(".bulk-actions").hide(), this.$el.find(".acf-gallery-main").animate({right: 350}, 250), this.$el.find(".acf-gallery-side").animate({width: 349}, 250)
        },
        close_sidebar: function () {
            this.$el.removeClass("sidebar-open");
            var e = this.$el.find(".bulk-actions");
            this.clear_selection(), this.$el.find(".acf-gallery-side").find("input, textarea, select").attr("disabled", "disabled"), this.$el.find(".acf-gallery-main").animate({right: 0}, 250), this.$el.find(".acf-gallery-side").animate({width: 0}, 250, function () {
                e.show(), t(this).find(".acf-gallery-side-data").html("")
            })
        },
        fetch: function (e) {
            var a = acf.prepare_for_ajax({
                action: "acf/fields/gallery/get_attachment",
                field_key: this.settings.key,
                nonce: acf.get("nonce"),
                post_id: acf.get("post_id"),
                id: e
            });
            this.$el.data("xhr") && this.$el.data("xhr").abort();
            var i = t.ajax({
                url: acf.get("ajaxurl"),
                dataType: "html",
                type: "post",
                cache: !1,
                data: a,
                context: this,
                success: this.render_fetch
            });
            this.$el.data("xhr", i)
        },
        render_fetch: function (t) {
            if (t) {
                var e = this.$el.find(".acf-gallery-side-data");
                e.html(t), e.find(".compat-field-acf-form-data").remove();
                var a = e.find("> .compat-attachment-fields > tbody > tr").detach();
                e.find("> table.form-table > tbody").append(a), e.find("> .compat-attachment-fields").remove(), acf.do_action("append", e)
            }
        },
        update_attachment: function () {
            var e = this.$el.find(".update-attachment");
            return $form = this.$el.find(".acf-gallery-side-data"), data = acf.serialize_form($form), e.attr("disabled") ? !1 : (e.attr("disabled", "disabled"), e.before('<i class="acf-loading"></i>'), data.action = "acf/fields/gallery/update_attachment", acf.prepare_for_ajax(data), void t.ajax({
                url: acf.get("ajaxurl"),
                data: data,
                type: "post",
                dataType: "json",
                complete: function (t) {
                    e.removeAttr("disabled"), e.prev(".acf-loading").remove()
                }
            }))
        },
        add: function (t) {
            if (this.settings.max > 0 && this.count() >= this.settings.max)return void acf.validation.add_warning(this.$field, acf._e("gallery", "max"));
            t.name = this.$el.find('[data-name="ids"]').attr("name");
            var e = acf._e("gallery", "tmpl"), a = _.template(e, t);
            this.$el.find(".acf-gallery-attachments").append(a), this.render()
        },
        edit_attachment: function (t) {
            var e = this, a = acf.get_data(t.$el, "id"), i = acf.media.popup({
                title: acf._e("image", "edit"),
                button: acf._e("image", "update"),
                mode: "edit",
                id: a,
                select: function (t) {
                    acf.isset(t, "attributes", "sizes", e.settings.preview_size, "url") && (t.url = t.attributes.sizes[e.settings.preview_size].url), e.get_attachment(a).find("img").attr("src", t.url), e.fetch(a)
                }
            })
        },
        remove_attachment: function (t) {
            t.stopPropagation();
            var e = acf.get_data(t.$el, "id");
            this.clear_selection(), this.close_sidebar(), this.get_attachment(e).remove(), this.render()
        },
        render_collection: function (t) {
            var e = this;
            setTimeout(function () {
                var a = t.content.get().$el;
                if (collection = t.content.get().collection || null) {
                    var i = -1;
                    collection.each(function (t) {
                        i++;
                        var l = a.find(".attachments > .attachment:eq(" + i + ")");
                        e.get_attachment(t.id).exists() && (t.off("selection:single"), l.addClass("acf-selected"))
                    })
                }
            }, 10)
        },
        add_attachment: function (t) {
            if (this.settings.max > 0 && this.count() >= this.settings.max)return void acf.validation.add_warning(this.$field, acf._e("gallery", "max"));
            var e = this.settings.library, a = this.settings.preview_size, i = this, l = acf.media.popup({
                title: acf._e("gallery", "select"),
                mode: "select",
                type: "all",
                multiple: "add",
                library: e,
                select: function (t, e) {
                    if (!i.get_attachment(t.id).exists()) {
                        var l = {id: t.id, url: t.attributes.url};
                        "image" != t.attributes.type && (l.url = t.attributes.icon), acf.isset(t, "attributes", "sizes", a) && (l.url = t.attributes.sizes[a].url), i.add(l)
                    }
                }
            });
            l.on("content:activate:browse", function () {
                i.render_collection(l), l.content.get().collection.on("reset add", function () {
                    i.render_collection(l)
                })
            })
        },
        resize: function () {
            for (var t = 100, e = 175, a = 4, i = this.$el.width(), l = 0; 10 > l; l++) {
                var s = i / l;
                if (s > t && e > s) {
                    a = l;
                    break
                }
            }
            this.$el.attr("data-columns", a)
        }
    })
}(jQuery);
